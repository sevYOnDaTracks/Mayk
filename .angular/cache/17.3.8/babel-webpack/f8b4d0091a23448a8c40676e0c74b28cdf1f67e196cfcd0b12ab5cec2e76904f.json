{"ast":null,"code":"import _asyncToGenerator from \"/Users/sevyondatracks/Downloads/dexamhtml-300/dexamhtml-300/dexam-angular-landing-page/dexam-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { AdmissionService } from '../../services/admission.service';\nimport { AngularFireStorage } from '@angular/fire/compat/storage';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/admission.service\";\nimport * as i3 from \"@angular/fire/compat/storage\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/form-field\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/material/select\";\nimport * as i9 from \"@angular/material/core\";\nfunction AdmissionComponent_mat_option_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const level_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", level_r1);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", level_r1, \" \");\n  }\n}\nfunction AdmissionComponent_div_7_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"mat-form-field\");\n    i0.ɵɵelement(2, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 14);\n    i0.ɵɵlistener(\"change\", function AdmissionComponent_div_7_div_8_Template_input_change_3_listener($event) {\n      const j_r4 = i0.ɵɵrestoreView(_r3).index;\n      const i_r5 = i0.ɵɵnextContext().index;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.uploadFile($event, i_r5, j_r4));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const j_r4 = ctx.index;\n    i0.ɵɵproperty(\"formGroupName\", j_r4);\n  }\n}\nfunction AdmissionComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mat-form-field\");\n    i0.ɵɵelement(4, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-form-field\");\n    i0.ɵɵelement(6, \"input\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 13);\n    i0.ɵɵtemplate(8, AdmissionComponent_div_7_div_8_Template, 4, 1, \"div\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function AdmissionComponent_div_7_Template_button_click_9_listener() {\n      const i_r5 = i0.ɵɵrestoreView(_r2).index;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.addFile(i_r5));\n    });\n    i0.ɵɵtext(10, \"Ajouter un bulletin\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const document_r7 = ctx.$implicit;\n    const i_r5 = ctx.index;\n    i0.ɵɵproperty(\"formGroupName\", i_r5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(document_r7.value.level);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", document_r7.controls.files.controls);\n  }\n}\nfunction AdmissionComponent_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function AdmissionComponent_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.addDocument(ctx_r5.admissionForm.get(\"degreeLevel\").value));\n    });\n    i0.ɵɵtext(1, \" Ajouter Document \");\n    i0.ɵɵelementEnd();\n  }\n}\n// ... (other imports)\nexport let AdmissionComponent = /*#__PURE__*/(() => {\n  class AdmissionComponent {\n    constructor(fb, admissionService, storage) {\n      this.fb = fb;\n      this.admissionService = admissionService;\n      this.storage = storage;\n      this.degreeLevels = ['Bac+0', 'Bac+1', 'Bac+2', 'Bac+3', 'Bac+4', 'Bac+5'];\n      this.admissionForm = this.fb.group({\n        userId: ['', Validators.required],\n        degreeLevel: ['', Validators.required],\n        documents: this.fb.array([])\n      });\n    }\n    get documents() {\n      return this.admissionForm.get('documents');\n    }\n    addDocument(level) {\n      const documentForm = this.fb.group({\n        level: [level],\n        description: [''],\n        average: [0],\n        files: this.fb.array([])\n      });\n      this.documents.push(documentForm);\n    }\n    addFile(documentIndex) {\n      const fileForm = this.fb.group({\n        description: [''],\n        url: ['']\n      });\n      this.documents.at(documentIndex).get('files').push(fileForm);\n    }\n    uploadFile(event, documentIndex, fileIndex) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const file = event.target.files[0];\n        if (!file) {\n          return; // Handle no file selected case\n        }\n        const filePath = `documents/${file.name}`;\n        const fileRef = _this.storage.ref(filePath);\n        const task = _this.storage.upload(filePath, file);\n        try {\n          yield task.snapshotChanges().pipe(finalize(() => {\n            fileRef.getDownloadURL().subscribe(url => {\n              _this.documents.at(documentIndex).get('files').at(fileIndex).patchValue({\n                url\n              });\n            });\n          })).toPromise();\n        } catch (error) {\n          console.error('Error uploading file:', error);\n          // Handle upload errors\n        }\n      })();\n    }\n    onSubmit() {\n      if (this.admissionForm.valid) {\n        this.admissionService.createAdmission(this.admissionForm.value).then(() => {\n          console.log('Admission submitted successfully');\n        });\n      }\n    }\n    ngOnInit() {}\n    static #_ = this.ɵfac = function AdmissionComponent_Factory(t) {\n      return new (t || AdmissionComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.AdmissionService), i0.ɵɵdirectiveInject(i3.AngularFireStorage));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AdmissionComponent,\n      selectors: [[\"app-admission\"]],\n      decls: 13,\n      vars: 4,\n      consts: [[3, \"ngSubmit\", \"formGroup\"], [\"matInput\", \"\", \"placeholder\", \"User ID\", \"formControlName\", \"userId\", \"required\", \"\"], [\"placeholder\", \"Niveau d'\\u00E9tude\", \"formControlName\", \"degreeLevel\", \"required\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"formArrayName\", \"documents\"], [3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [\"mat-button\", \"\", \"type\", \"button\", 3, \"click\"], [\"mat-button\", \"\", \"type\", \"button\", 3, \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\"], [3, \"value\"], [3, \"formGroupName\"], [\"matInput\", \"\", \"placeholder\", \"Description\", \"formControlName\", \"description\"], [\"matInput\", \"\", \"type\", \"number\", \"placeholder\", \"Moyenne /20\", \"formControlName\", \"average\"], [\"formArrayName\", \"files\"], [\"type\", \"file\", 3, \"change\"]],\n      template: function AdmissionComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"form\", 0);\n          i0.ɵɵlistener(\"ngSubmit\", function AdmissionComponent_Template_form_ngSubmit_0_listener() {\n            return ctx.onSubmit();\n          });\n          i0.ɵɵelementStart(1, \"mat-form-field\");\n          i0.ɵɵelement(2, \"input\", 1);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"mat-form-field\")(4, \"mat-select\", 2);\n          i0.ɵɵtemplate(5, AdmissionComponent_mat_option_5_Template, 2, 2, \"mat-option\", 3);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(6, \"div\", 4);\n          i0.ɵɵtemplate(7, AdmissionComponent_div_7_Template, 11, 3, \"div\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"button\", 6);\n          i0.ɵɵlistener(\"click\", function AdmissionComponent_Template_button_click_8_listener() {\n            return ctx.addDocument(\"Baccalaureat\");\n          });\n          i0.ɵɵtext(9, \"Ajouter Baccalaureat\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(10, AdmissionComponent_button_10_Template, 2, 0, \"button\", 7);\n          i0.ɵɵelementStart(11, \"button\", 8);\n          i0.ɵɵtext(12, \"Soumettre\");\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"formGroup\", ctx.admissionForm);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.degreeLevels);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.documents.controls);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.admissionForm.get(\"degreeLevel\").value);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.FormGroupDirective, i1.FormControlName, i1.FormGroupName, i1.FormArrayName, i5.MatFormField, i6.MatButton, i7.MatInput, i8.MatSelect, i9.MatOption],\n      styles: [\"mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}input[type=file][_ngcontent-%COMP%]{margin-bottom:15px}\"]\n    });\n  }\n  return AdmissionComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}